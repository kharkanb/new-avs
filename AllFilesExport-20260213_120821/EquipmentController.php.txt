================================================================================
                            EquipmentController.php
================================================================================
تعداد فایل‌ها: 10
تاریخ ایجاد: 2026/02/13 12:08:27
مسیر پایه: C:\Users\dear-user\Desktop\complete-avs
================================================================================

--------------------------------------------------------------------------------
【فایل 1】: EquipmentController (2).php
📁 مسیر: app\Http\Controllers\Api\EquipmentController (2).php
📅 تاریخ آخرین تغییر: 02/13/2026 00:26:44
📏 حجم: 1269 بایت
--------------------------------------------------------------------------------

<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\Equipment;
use Illuminate\Http\Request;
use Illuminate\Http\JsonResponse;

class EquipmentController extends Controller
{
    public function store(Request $request): JsonResponse
    {
        $validated = $request->validate([
            'inspection_id' => 'required|exists:inspections,id',
            'equipment_index' => 'required|integer',
            'equipment_type' => 'required|string|max:100',
            'scada_code' => 'nullable|string|max:10',
            'switch_brand' => 'nullable|string|max:100',
            'modem_brand' => 'nullable|string|max:100',
            'rtu_brand' => 'nullable|string|max:100',
        ]);

        $equipment = Equipment::create($validated);
        return response()->json($equipment, 201);
    }

    public function show(int $id): JsonResponse
    {
        $equipment = Equipment::with(['inspection', 'feeders'])->findOrFail($id);
        return response()->json($equipment);
    }

    public function destroy(int $id): JsonResponse
    {
        $equipment = Equipment::findOrFail($id);
        $equipment->delete();
        return response()->json(['message' => 'ØªØ¬Ù‡ÛŒØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯']);
    }
}


--------------------------------------------------------------------------------
【فایل 2】: EquipmentController (3).php
📁 مسیر: app\Http\Controllers\Api\EquipmentController (3).php
📅 تاریخ آخرین تغییر: 02/12/2026 23:48:56
📏 حجم: 11608 بایت
--------------------------------------------------------------------------------

<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\Equipment;
use App\Models\EquipmentLocation;
use App\Models\EquipmentCommunication;
use App\Models\ChecklistItem;
use App\Models\Activity;
use App\Models\Consumable;
use App\Models\CellSpecification;
use App\Models\CellEquipment;
use Illuminate\Http\Request;
use Illuminate\Http\JsonResponse;

class EquipmentController extends Controller
{
    public function store(Request $request): JsonResponse
    {
        $validated = $request->validate([
            "inspection_id" => "required|exists:inspections,id",
            "equipment_index" => "required|integer",
            "equipment_type" => "required|string|max:100",
            "scada_code" => "nullable|string|max:10",
            "installation_type" => "nullable|string|max:50",
            "switch_brand" => "nullable|string|max:100",
            "modem_brand" => "nullable|string|max:100",
            "rtu_brand" => "nullable|string|max:100",
            "other_switch_brand" => "nullable|string|max:100",
            "other_modem_brand" => "nullable|string|max:100",
            "other_rtu_brand" => "nullable|string|max:100",
            "start_time" => "nullable|date_format:H:i",
            "end_time" => "nullable|date_format:H:i",
            "department" => "nullable|string|max:100",
            "city_gis_code" => "nullable|string|max:100",
            
            // ÙÛŒØ¯Ø±Ù‡Ø§
            "feeders" => "nullable|array",
            "feeders.*.feeder_number" => "required_with:feeders|integer",
            "feeders.*.post_name" => "required_with:feeders|string",
            "feeders.*.feeder_name" => "required_with:feeders|string",
            
            // Ù…ÙˆÙ‚Ø¹ÛŒØª
            "latitude" => "nullable|string|max:50",
            "longitude" => "nullable|string|max:50",
            "installation_address" => "nullable|string",
            "cabinet_initial_height" => "nullable|numeric",
            "cabinet_final_height" => "nullable|numeric",
            
            // Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
            "simcard_type" => "nullable|string|max:50",
            "simcard_number" => "nullable|string|max:20",
            "simcard_ip" => "nullable|string|max:20",
            "antenna_status" => "nullable|string|max:50",
            "signal_status" => "nullable|string|max:50",
            "modem_power" => "nullable|string|max:50",
            "reset_possible" => "nullable|boolean",
            
            // Ú†Ú©â€ŒÙ„ÛŒØ³Øª
            "checklist_items" => "nullable|array",
            "checklist_items.*.item_index" => "required_with:checklist_items|integer",
            "checklist_items.*.item_text" => "required_with:checklist_items|string",
            "checklist_items.*.status" => "nullable|in:OK,Not OK,Not Checked",
            "checklist_items.*.description" => "nullable|string",
            
            // ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§
            "activities" => "nullable|array",
            "activities.*.activity_code" => "required_with:activities|string|max:20",
            "activities.*.activity_title" => "nullable|string",
            "activities.*.unit" => "nullable|string|max:50",
            "activities.*.unit_price" => "nullable|numeric",
            "activities.*.quantity" => "nullable|integer|min:1",
            
            // Ù…ØµØ§Ø±Ù
            "consumables" => "nullable|array",
            "consumables.*.item_name" => "required_with:consumables|string|max:200",
            "consumables.*.quantity" => "nullable|integer|min:1",
            "consumables.*.unit" => "nullable|string|max:50",
            "consumables.*.description" => "nullable|string",
            "consumables.*.other_name" => "nullable|string|max:200",
            
            // Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§
            "cell_specifications" => "nullable|array",
            "cell_specifications.*.cell_type" => "required_with:cell_specifications|in:input,output,measurement",
            "cell_specifications.*.cell_number" => "required_with:cell_specifications|integer",
            "cell_specifications.*.cell_notes" => "nullable|string",
            "cell_specifications.*.cell_equipments" => "nullable|array",
            "cell_specifications.*.cell_equipments.*.equipment_type" => "required_with:cell_specifications.*.cell_equipments|string|max:100",
            "cell_specifications.*.cell_equipments.*.brand" => "nullable|string|max:100",
            "cell_specifications.*.cell_equipments.*.other_brand" => "nullable|string|max:100",
            "cell_specifications.*.cell_equipments.*.manual_name" => "nullable|string|max:200",
        ]);

        // Ø§ÛŒØ¬Ø§Ø¯ ØªØ¬Ù‡ÛŒØ² Ø§ØµÙ„ÛŒ
        $equipment = Equipment::create([
            "inspection_id" => $validated["inspection_id"],
            "equipment_index" => $validated["equipment_index"],
            "equipment_type" => $validated["equipment_type"],
            "scada_code" => $validated["scada_code"] ?? null,
            "installation_type" => $validated["installation_type"] ?? null,
            "switch_brand" => $validated["switch_brand"] ?? null,
            "modem_brand" => $validated["modem_brand"] ?? null,
            "rtu_brand" => $validated["rtu_brand"] ?? null,
            "other_switch_brand" => $validated["other_switch_brand"] ?? null,
            "other_modem_brand" => $validated["other_modem_brand"] ?? null,
            "other_rtu_brand" => $validated["other_rtu_brand"] ?? null,
            "start_time" => $validated["start_time"] ?? null,
            "end_time" => $validated["end_time"] ?? null,
            "department" => $validated["department"] ?? null,
            "city_gis_code" => $validated["city_gis_code"] ?? null,
        ]);

        // Ø°Ø®ÛŒØ±Ù‡ ÙÛŒØ¯Ø±Ù‡Ø§
        if ($request->has("feeders")) {
            $feedersData = [];
            foreach ($validated["feeders"] as $index => $feeder) {
                $feedersData[$feeder["feeder_name"]] = [
                    "feeder_number" => $feeder["feeder_number"],
                    "post_name" => $feeder["post_name"],
                    "feeder_name" => $feeder["feeder_name"]
                ];
            }
            $equipment->feeders()->sync($feedersData);
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª
        if ($request->hasAny(["latitude", "longitude", "installation_address", "cabinet_initial_height", "cabinet_final_height"])) {
            EquipmentLocation::create([
                "equipment_id" => $equipment->id,
                "latitude" => $validated["latitude"] ?? null,
                "longitude" => $validated["longitude"] ?? null,
                "installation_address" => $validated["installation_address"] ?? null,
                "cabinet_initial_height" => $validated["cabinet_initial_height"] ?? null,
                "cabinet_final_height" => $validated["cabinet_final_height"] ?? null,
            ]);
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
        if ($request->hasAny(["simcard_type", "simcard_number", "simcard_ip", "antenna_status", "signal_status", "modem_power"])) {
            EquipmentCommunication::create([
                "equipment_id" => $equipment->id,
                "simcard_type" => $validated["simcard_type"] ?? null,
                "simcard_number" => $validated["simcard_number"] ?? null,
                "simcard_ip" => $validated["simcard_ip"] ?? null,
                "antenna_status" => $validated["antenna_status"] ?? null,
                "signal_status" => $validated["signal_status"] ?? null,
                "modem_power" => $validated["modem_power"] ?? null,
                "reset_possible" => $validated["reset_possible"] ?? false,
            ]);
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ú†Ú©â€ŒÙ„ÛŒØ³Øª
        if ($request->has("checklist_items")) {
            foreach ($validated["checklist_items"] as $item) {
                ChecklistItem::create([
                    "equipment_id" => $equipment->id,
                    "item_index" => $item["item_index"],
                    "item_text" => $item["item_text"],
                    "status" => $item["status"] ?? "Not Checked",
                    "description" => $item["description"] ?? null,
                ]);
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§
        if ($request->has("activities")) {
            foreach ($validated["activities"] as $activity) {
                $quantity = $activity["quantity"] ?? 1;
                $unitPrice = $activity["unit_price"] ?? 0;
                
                Activity::create([
                    "equipment_id" => $equipment->id,
                    "activity_code" => $activity["activity_code"],
                    "activity_title" => $activity["activity_title"] ?? null,
                    "unit" => $activity["unit"] ?? null,
                    "unit_price" => $unitPrice,
                    "quantity" => $quantity,
                    "total_price" => $quantity * $unitPrice,
                ]);
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ù…ØµØ§Ø±Ù
        if ($request->has("consumables")) {
            foreach ($validated["consumables"] as $consumable) {
                Consumable::create([
                    "equipment_id" => $equipment->id,
                    "item_name" => $consumable["item_name"],
                    "quantity" => $consumable["quantity"] ?? 1,
                    "unit" => $consumable["unit"] ?? null,
                    "description" => $consumable["description"] ?? null,
                    "other_name" => $consumable["other_name"] ?? null,
                ]);
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§
        if ($request->has("cell_specifications")) {
            foreach ($validated["cell_specifications"] as $spec) {
                $cellSpec = CellSpecification::create([
                    "equipment_id" => $equipment->id,
                    "cell_type" => $spec["cell_type"],
                    "cell_number" => $spec["cell_number"],
                    "cell_notes" => $spec["cell_notes"] ?? null,
                ]);
                
                if (isset($spec["cell_equipments"])) {
                    foreach ($spec["cell_equipments"] as $cellEq) {
                        CellEquipment::create([
                            "cell_id" => $cellSpec->id,
                            "equipment_type" => $cellEq["equipment_type"],
                            "brand" => $cellEq["brand"] ?? null,
                            "other_brand" => $cellEq["other_brand"] ?? null,
                            "manual_name" => $cellEq["manual_name"] ?? null,
                        ]);
                    }
                }
            }
        }

        return response()->json($equipment->load([
            "feeders",
            "location",
            "communication",
            "checklistItems",
            "activities",
            "consumables",
            "cellSpecifications.cellEquipments"
        ]), 201);
    }

    public function show(int $id): JsonResponse
    {
        $equipment = Equipment::with([
            "feeders",
            "location",
            "communication",
            "checklistItems",
            "activities",
            "consumables",
            "cellSpecifications.cellEquipments"
        ])->findOrFail($id);
        
        return response()->json($equipment);
    }

    public function destroy(int $id): JsonResponse
    {
        $equipment = Equipment::findOrFail($id);
        $equipment->delete();
        
        return response()->json(["message" => "ØªØ¬Ù‡ÛŒØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯"]);
    }
}

--------------------------------------------------------------------------------
【فایل 3】: EquipmentController (4).php
📁 مسیر: app\Http\Controllers\Api\EquipmentController (4).php
📅 تاریخ آخرین تغییر: 02/13/2026 00:26:44
📏 حجم: 1269 بایت
--------------------------------------------------------------------------------

<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\Equipment;
use Illuminate\Http\Request;
use Illuminate\Http\JsonResponse;

class EquipmentController extends Controller
{
    public function store(Request $request): JsonResponse
    {
        $validated = $request->validate([
            'inspection_id' => 'required|exists:inspections,id',
            'equipment_index' => 'required|integer',
            'equipment_type' => 'required|string|max:100',
            'scada_code' => 'nullable|string|max:10',
            'switch_brand' => 'nullable|string|max:100',
            'modem_brand' => 'nullable|string|max:100',
            'rtu_brand' => 'nullable|string|max:100',
        ]);

        $equipment = Equipment::create($validated);
        return response()->json($equipment, 201);
    }

    public function show(int $id): JsonResponse
    {
        $equipment = Equipment::with(['inspection', 'feeders'])->findOrFail($id);
        return response()->json($equipment);
    }

    public function destroy(int $id): JsonResponse
    {
        $equipment = Equipment::findOrFail($id);
        $equipment->delete();
        return response()->json(['message' => 'ØªØ¬Ù‡ÛŒØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯']);
    }
}


--------------------------------------------------------------------------------
【فایل 4】: EquipmentController (5).php
📁 مسیر: app\Http\Controllers\Api\EquipmentController (5).php
📅 تاریخ آخرین تغییر: 02/12/2026 23:48:56
📏 حجم: 11608 بایت
--------------------------------------------------------------------------------

<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\Equipment;
use App\Models\EquipmentLocation;
use App\Models\EquipmentCommunication;
use App\Models\ChecklistItem;
use App\Models\Activity;
use App\Models\Consumable;
use App\Models\CellSpecification;
use App\Models\CellEquipment;
use Illuminate\Http\Request;
use Illuminate\Http\JsonResponse;

class EquipmentController extends Controller
{
    public function store(Request $request): JsonResponse
    {
        $validated = $request->validate([
            "inspection_id" => "required|exists:inspections,id",
            "equipment_index" => "required|integer",
            "equipment_type" => "required|string|max:100",
            "scada_code" => "nullable|string|max:10",
            "installation_type" => "nullable|string|max:50",
            "switch_brand" => "nullable|string|max:100",
            "modem_brand" => "nullable|string|max:100",
            "rtu_brand" => "nullable|string|max:100",
            "other_switch_brand" => "nullable|string|max:100",
            "other_modem_brand" => "nullable|string|max:100",
            "other_rtu_brand" => "nullable|string|max:100",
            "start_time" => "nullable|date_format:H:i",
            "end_time" => "nullable|date_format:H:i",
            "department" => "nullable|string|max:100",
            "city_gis_code" => "nullable|string|max:100",
            
            // ÙÛŒØ¯Ø±Ù‡Ø§
            "feeders" => "nullable|array",
            "feeders.*.feeder_number" => "required_with:feeders|integer",
            "feeders.*.post_name" => "required_with:feeders|string",
            "feeders.*.feeder_name" => "required_with:feeders|string",
            
            // Ù…ÙˆÙ‚Ø¹ÛŒØª
            "latitude" => "nullable|string|max:50",
            "longitude" => "nullable|string|max:50",
            "installation_address" => "nullable|string",
            "cabinet_initial_height" => "nullable|numeric",
            "cabinet_final_height" => "nullable|numeric",
            
            // Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
            "simcard_type" => "nullable|string|max:50",
            "simcard_number" => "nullable|string|max:20",
            "simcard_ip" => "nullable|string|max:20",
            "antenna_status" => "nullable|string|max:50",
            "signal_status" => "nullable|string|max:50",
            "modem_power" => "nullable|string|max:50",
            "reset_possible" => "nullable|boolean",
            
            // Ú†Ú©â€ŒÙ„ÛŒØ³Øª
            "checklist_items" => "nullable|array",
            "checklist_items.*.item_index" => "required_with:checklist_items|integer",
            "checklist_items.*.item_text" => "required_with:checklist_items|string",
            "checklist_items.*.status" => "nullable|in:OK,Not OK,Not Checked",
            "checklist_items.*.description" => "nullable|string",
            
            // ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§
            "activities" => "nullable|array",
            "activities.*.activity_code" => "required_with:activities|string|max:20",
            "activities.*.activity_title" => "nullable|string",
            "activities.*.unit" => "nullable|string|max:50",
            "activities.*.unit_price" => "nullable|numeric",
            "activities.*.quantity" => "nullable|integer|min:1",
            
            // Ù…ØµØ§Ø±Ù
            "consumables" => "nullable|array",
            "consumables.*.item_name" => "required_with:consumables|string|max:200",
            "consumables.*.quantity" => "nullable|integer|min:1",
            "consumables.*.unit" => "nullable|string|max:50",
            "consumables.*.description" => "nullable|string",
            "consumables.*.other_name" => "nullable|string|max:200",
            
            // Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§
            "cell_specifications" => "nullable|array",
            "cell_specifications.*.cell_type" => "required_with:cell_specifications|in:input,output,measurement",
            "cell_specifications.*.cell_number" => "required_with:cell_specifications|integer",
            "cell_specifications.*.cell_notes" => "nullable|string",
            "cell_specifications.*.cell_equipments" => "nullable|array",
            "cell_specifications.*.cell_equipments.*.equipment_type" => "required_with:cell_specifications.*.cell_equipments|string|max:100",
            "cell_specifications.*.cell_equipments.*.brand" => "nullable|string|max:100",
            "cell_specifications.*.cell_equipments.*.other_brand" => "nullable|string|max:100",
            "cell_specifications.*.cell_equipments.*.manual_name" => "nullable|string|max:200",
        ]);

        // Ø§ÛŒØ¬Ø§Ø¯ ØªØ¬Ù‡ÛŒØ² Ø§ØµÙ„ÛŒ
        $equipment = Equipment::create([
            "inspection_id" => $validated["inspection_id"],
            "equipment_index" => $validated["equipment_index"],
            "equipment_type" => $validated["equipment_type"],
            "scada_code" => $validated["scada_code"] ?? null,
            "installation_type" => $validated["installation_type"] ?? null,
            "switch_brand" => $validated["switch_brand"] ?? null,
            "modem_brand" => $validated["modem_brand"] ?? null,
            "rtu_brand" => $validated["rtu_brand"] ?? null,
            "other_switch_brand" => $validated["other_switch_brand"] ?? null,
            "other_modem_brand" => $validated["other_modem_brand"] ?? null,
            "other_rtu_brand" => $validated["other_rtu_brand"] ?? null,
            "start_time" => $validated["start_time"] ?? null,
            "end_time" => $validated["end_time"] ?? null,
            "department" => $validated["department"] ?? null,
            "city_gis_code" => $validated["city_gis_code"] ?? null,
        ]);

        // Ø°Ø®ÛŒØ±Ù‡ ÙÛŒØ¯Ø±Ù‡Ø§
        if ($request->has("feeders")) {
            $feedersData = [];
            foreach ($validated["feeders"] as $index => $feeder) {
                $feedersData[$feeder["feeder_name"]] = [
                    "feeder_number" => $feeder["feeder_number"],
                    "post_name" => $feeder["post_name"],
                    "feeder_name" => $feeder["feeder_name"]
                ];
            }
            $equipment->feeders()->sync($feedersData);
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª
        if ($request->hasAny(["latitude", "longitude", "installation_address", "cabinet_initial_height", "cabinet_final_height"])) {
            EquipmentLocation::create([
                "equipment_id" => $equipment->id,
                "latitude" => $validated["latitude"] ?? null,
                "longitude" => $validated["longitude"] ?? null,
                "installation_address" => $validated["installation_address"] ?? null,
                "cabinet_initial_height" => $validated["cabinet_initial_height"] ?? null,
                "cabinet_final_height" => $validated["cabinet_final_height"] ?? null,
            ]);
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
        if ($request->hasAny(["simcard_type", "simcard_number", "simcard_ip", "antenna_status", "signal_status", "modem_power"])) {
            EquipmentCommunication::create([
                "equipment_id" => $equipment->id,
                "simcard_type" => $validated["simcard_type"] ?? null,
                "simcard_number" => $validated["simcard_number"] ?? null,
                "simcard_ip" => $validated["simcard_ip"] ?? null,
                "antenna_status" => $validated["antenna_status"] ?? null,
                "signal_status" => $validated["signal_status"] ?? null,
                "modem_power" => $validated["modem_power"] ?? null,
                "reset_possible" => $validated["reset_possible"] ?? false,
            ]);
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ú†Ú©â€ŒÙ„ÛŒØ³Øª
        if ($request->has("checklist_items")) {
            foreach ($validated["checklist_items"] as $item) {
                ChecklistItem::create([
                    "equipment_id" => $equipment->id,
                    "item_index" => $item["item_index"],
                    "item_text" => $item["item_text"],
                    "status" => $item["status"] ?? "Not Checked",
                    "description" => $item["description"] ?? null,
                ]);
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§
        if ($request->has("activities")) {
            foreach ($validated["activities"] as $activity) {
                $quantity = $activity["quantity"] ?? 1;
                $unitPrice = $activity["unit_price"] ?? 0;
                
                Activity::create([
                    "equipment_id" => $equipment->id,
                    "activity_code" => $activity["activity_code"],
                    "activity_title" => $activity["activity_title"] ?? null,
                    "unit" => $activity["unit"] ?? null,
                    "unit_price" => $unitPrice,
                    "quantity" => $quantity,
                    "total_price" => $quantity * $unitPrice,
                ]);
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ù…ØµØ§Ø±Ù
        if ($request->has("consumables")) {
            foreach ($validated["consumables"] as $consumable) {
                Consumable::create([
                    "equipment_id" => $equipment->id,
                    "item_name" => $consumable["item_name"],
                    "quantity" => $consumable["quantity"] ?? 1,
                    "unit" => $consumable["unit"] ?? null,
                    "description" => $consumable["description"] ?? null,
                    "other_name" => $consumable["other_name"] ?? null,
                ]);
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§
        if ($request->has("cell_specifications")) {
            foreach ($validated["cell_specifications"] as $spec) {
                $cellSpec = CellSpecification::create([
                    "equipment_id" => $equipment->id,
                    "cell_type" => $spec["cell_type"],
                    "cell_number" => $spec["cell_number"],
                    "cell_notes" => $spec["cell_notes"] ?? null,
                ]);
                
                if (isset($spec["cell_equipments"])) {
                    foreach ($spec["cell_equipments"] as $cellEq) {
                        CellEquipment::create([
                            "cell_id" => $cellSpec->id,
                            "equipment_type" => $cellEq["equipment_type"],
                            "brand" => $cellEq["brand"] ?? null,
                            "other_brand" => $cellEq["other_brand"] ?? null,
                            "manual_name" => $cellEq["manual_name"] ?? null,
                        ]);
                    }
                }
            }
        }

        return response()->json($equipment->load([
            "feeders",
            "location",
            "communication",
            "checklistItems",
            "activities",
            "consumables",
            "cellSpecifications.cellEquipments"
        ]), 201);
    }

    public function show(int $id): JsonResponse
    {
        $equipment = Equipment::with([
            "feeders",
            "location",
            "communication",
            "checklistItems",
            "activities",
            "consumables",
            "cellSpecifications.cellEquipments"
        ])->findOrFail($id);
        
        return response()->json($equipment);
    }

    public function destroy(int $id): JsonResponse
    {
        $equipment = Equipment::findOrFail($id);
        $equipment->delete();
        
        return response()->json(["message" => "ØªØ¬Ù‡ÛŒØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯"]);
    }
}

--------------------------------------------------------------------------------
【فایل 5】: EquipmentController (6).php
📁 مسیر: app\Http\Controllers\Api\EquipmentController (6).php
📅 تاریخ آخرین تغییر: 02/13/2026 00:26:44
📏 حجم: 1269 بایت
--------------------------------------------------------------------------------

<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\Equipment;
use Illuminate\Http\Request;
use Illuminate\Http\JsonResponse;

class EquipmentController extends Controller
{
    public function store(Request $request): JsonResponse
    {
        $validated = $request->validate([
            'inspection_id' => 'required|exists:inspections,id',
            'equipment_index' => 'required|integer',
            'equipment_type' => 'required|string|max:100',
            'scada_code' => 'nullable|string|max:10',
            'switch_brand' => 'nullable|string|max:100',
            'modem_brand' => 'nullable|string|max:100',
            'rtu_brand' => 'nullable|string|max:100',
        ]);

        $equipment = Equipment::create($validated);
        return response()->json($equipment, 201);
    }

    public function show(int $id): JsonResponse
    {
        $equipment = Equipment::with(['inspection', 'feeders'])->findOrFail($id);
        return response()->json($equipment);
    }

    public function destroy(int $id): JsonResponse
    {
        $equipment = Equipment::findOrFail($id);
        $equipment->delete();
        return response()->json(['message' => 'ØªØ¬Ù‡ÛŒØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯']);
    }
}


--------------------------------------------------------------------------------
【فایل 6】: EquipmentController (7).php
📁 مسیر: app\Http\Controllers\Api\EquipmentController (7).php
📅 تاریخ آخرین تغییر: 02/12/2026 23:48:56
📏 حجم: 11608 بایت
--------------------------------------------------------------------------------

<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\Equipment;
use App\Models\EquipmentLocation;
use App\Models\EquipmentCommunication;
use App\Models\ChecklistItem;
use App\Models\Activity;
use App\Models\Consumable;
use App\Models\CellSpecification;
use App\Models\CellEquipment;
use Illuminate\Http\Request;
use Illuminate\Http\JsonResponse;

class EquipmentController extends Controller
{
    public function store(Request $request): JsonResponse
    {
        $validated = $request->validate([
            "inspection_id" => "required|exists:inspections,id",
            "equipment_index" => "required|integer",
            "equipment_type" => "required|string|max:100",
            "scada_code" => "nullable|string|max:10",
            "installation_type" => "nullable|string|max:50",
            "switch_brand" => "nullable|string|max:100",
            "modem_brand" => "nullable|string|max:100",
            "rtu_brand" => "nullable|string|max:100",
            "other_switch_brand" => "nullable|string|max:100",
            "other_modem_brand" => "nullable|string|max:100",
            "other_rtu_brand" => "nullable|string|max:100",
            "start_time" => "nullable|date_format:H:i",
            "end_time" => "nullable|date_format:H:i",
            "department" => "nullable|string|max:100",
            "city_gis_code" => "nullable|string|max:100",
            
            // ÙÛŒØ¯Ø±Ù‡Ø§
            "feeders" => "nullable|array",
            "feeders.*.feeder_number" => "required_with:feeders|integer",
            "feeders.*.post_name" => "required_with:feeders|string",
            "feeders.*.feeder_name" => "required_with:feeders|string",
            
            // Ù…ÙˆÙ‚Ø¹ÛŒØª
            "latitude" => "nullable|string|max:50",
            "longitude" => "nullable|string|max:50",
            "installation_address" => "nullable|string",
            "cabinet_initial_height" => "nullable|numeric",
            "cabinet_final_height" => "nullable|numeric",
            
            // Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
            "simcard_type" => "nullable|string|max:50",
            "simcard_number" => "nullable|string|max:20",
            "simcard_ip" => "nullable|string|max:20",
            "antenna_status" => "nullable|string|max:50",
            "signal_status" => "nullable|string|max:50",
            "modem_power" => "nullable|string|max:50",
            "reset_possible" => "nullable|boolean",
            
            // Ú†Ú©â€ŒÙ„ÛŒØ³Øª
            "checklist_items" => "nullable|array",
            "checklist_items.*.item_index" => "required_with:checklist_items|integer",
            "checklist_items.*.item_text" => "required_with:checklist_items|string",
            "checklist_items.*.status" => "nullable|in:OK,Not OK,Not Checked",
            "checklist_items.*.description" => "nullable|string",
            
            // ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§
            "activities" => "nullable|array",
            "activities.*.activity_code" => "required_with:activities|string|max:20",
            "activities.*.activity_title" => "nullable|string",
            "activities.*.unit" => "nullable|string|max:50",
            "activities.*.unit_price" => "nullable|numeric",
            "activities.*.quantity" => "nullable|integer|min:1",
            
            // Ù…ØµØ§Ø±Ù
            "consumables" => "nullable|array",
            "consumables.*.item_name" => "required_with:consumables|string|max:200",
            "consumables.*.quantity" => "nullable|integer|min:1",
            "consumables.*.unit" => "nullable|string|max:50",
            "consumables.*.description" => "nullable|string",
            "consumables.*.other_name" => "nullable|string|max:200",
            
            // Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§
            "cell_specifications" => "nullable|array",
            "cell_specifications.*.cell_type" => "required_with:cell_specifications|in:input,output,measurement",
            "cell_specifications.*.cell_number" => "required_with:cell_specifications|integer",
            "cell_specifications.*.cell_notes" => "nullable|string",
            "cell_specifications.*.cell_equipments" => "nullable|array",
            "cell_specifications.*.cell_equipments.*.equipment_type" => "required_with:cell_specifications.*.cell_equipments|string|max:100",
            "cell_specifications.*.cell_equipments.*.brand" => "nullable|string|max:100",
            "cell_specifications.*.cell_equipments.*.other_brand" => "nullable|string|max:100",
            "cell_specifications.*.cell_equipments.*.manual_name" => "nullable|string|max:200",
        ]);

        // Ø§ÛŒØ¬Ø§Ø¯ ØªØ¬Ù‡ÛŒØ² Ø§ØµÙ„ÛŒ
        $equipment = Equipment::create([
            "inspection_id" => $validated["inspection_id"],
            "equipment_index" => $validated["equipment_index"],
            "equipment_type" => $validated["equipment_type"],
            "scada_code" => $validated["scada_code"] ?? null,
            "installation_type" => $validated["installation_type"] ?? null,
            "switch_brand" => $validated["switch_brand"] ?? null,
            "modem_brand" => $validated["modem_brand"] ?? null,
            "rtu_brand" => $validated["rtu_brand"] ?? null,
            "other_switch_brand" => $validated["other_switch_brand"] ?? null,
            "other_modem_brand" => $validated["other_modem_brand"] ?? null,
            "other_rtu_brand" => $validated["other_rtu_brand"] ?? null,
            "start_time" => $validated["start_time"] ?? null,
            "end_time" => $validated["end_time"] ?? null,
            "department" => $validated["department"] ?? null,
            "city_gis_code" => $validated["city_gis_code"] ?? null,
        ]);

        // Ø°Ø®ÛŒØ±Ù‡ ÙÛŒØ¯Ø±Ù‡Ø§
        if ($request->has("feeders")) {
            $feedersData = [];
            foreach ($validated["feeders"] as $index => $feeder) {
                $feedersData[$feeder["feeder_name"]] = [
                    "feeder_number" => $feeder["feeder_number"],
                    "post_name" => $feeder["post_name"],
                    "feeder_name" => $feeder["feeder_name"]
                ];
            }
            $equipment->feeders()->sync($feedersData);
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª
        if ($request->hasAny(["latitude", "longitude", "installation_address", "cabinet_initial_height", "cabinet_final_height"])) {
            EquipmentLocation::create([
                "equipment_id" => $equipment->id,
                "latitude" => $validated["latitude"] ?? null,
                "longitude" => $validated["longitude"] ?? null,
                "installation_address" => $validated["installation_address"] ?? null,
                "cabinet_initial_height" => $validated["cabinet_initial_height"] ?? null,
                "cabinet_final_height" => $validated["cabinet_final_height"] ?? null,
            ]);
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
        if ($request->hasAny(["simcard_type", "simcard_number", "simcard_ip", "antenna_status", "signal_status", "modem_power"])) {
            EquipmentCommunication::create([
                "equipment_id" => $equipment->id,
                "simcard_type" => $validated["simcard_type"] ?? null,
                "simcard_number" => $validated["simcard_number"] ?? null,
                "simcard_ip" => $validated["simcard_ip"] ?? null,
                "antenna_status" => $validated["antenna_status"] ?? null,
                "signal_status" => $validated["signal_status"] ?? null,
                "modem_power" => $validated["modem_power"] ?? null,
                "reset_possible" => $validated["reset_possible"] ?? false,
            ]);
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ú†Ú©â€ŒÙ„ÛŒØ³Øª
        if ($request->has("checklist_items")) {
            foreach ($validated["checklist_items"] as $item) {
                ChecklistItem::create([
                    "equipment_id" => $equipment->id,
                    "item_index" => $item["item_index"],
                    "item_text" => $item["item_text"],
                    "status" => $item["status"] ?? "Not Checked",
                    "description" => $item["description"] ?? null,
                ]);
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§
        if ($request->has("activities")) {
            foreach ($validated["activities"] as $activity) {
                $quantity = $activity["quantity"] ?? 1;
                $unitPrice = $activity["unit_price"] ?? 0;
                
                Activity::create([
                    "equipment_id" => $equipment->id,
                    "activity_code" => $activity["activity_code"],
                    "activity_title" => $activity["activity_title"] ?? null,
                    "unit" => $activity["unit"] ?? null,
                    "unit_price" => $unitPrice,
                    "quantity" => $quantity,
                    "total_price" => $quantity * $unitPrice,
                ]);
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ù…ØµØ§Ø±Ù
        if ($request->has("consumables")) {
            foreach ($validated["consumables"] as $consumable) {
                Consumable::create([
                    "equipment_id" => $equipment->id,
                    "item_name" => $consumable["item_name"],
                    "quantity" => $consumable["quantity"] ?? 1,
                    "unit" => $consumable["unit"] ?? null,
                    "description" => $consumable["description"] ?? null,
                    "other_name" => $consumable["other_name"] ?? null,
                ]);
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§
        if ($request->has("cell_specifications")) {
            foreach ($validated["cell_specifications"] as $spec) {
                $cellSpec = CellSpecification::create([
                    "equipment_id" => $equipment->id,
                    "cell_type" => $spec["cell_type"],
                    "cell_number" => $spec["cell_number"],
                    "cell_notes" => $spec["cell_notes"] ?? null,
                ]);
                
                if (isset($spec["cell_equipments"])) {
                    foreach ($spec["cell_equipments"] as $cellEq) {
                        CellEquipment::create([
                            "cell_id" => $cellSpec->id,
                            "equipment_type" => $cellEq["equipment_type"],
                            "brand" => $cellEq["brand"] ?? null,
                            "other_brand" => $cellEq["other_brand"] ?? null,
                            "manual_name" => $cellEq["manual_name"] ?? null,
                        ]);
                    }
                }
            }
        }

        return response()->json($equipment->load([
            "feeders",
            "location",
            "communication",
            "checklistItems",
            "activities",
            "consumables",
            "cellSpecifications.cellEquipments"
        ]), 201);
    }

    public function show(int $id): JsonResponse
    {
        $equipment = Equipment::with([
            "feeders",
            "location",
            "communication",
            "checklistItems",
            "activities",
            "consumables",
            "cellSpecifications.cellEquipments"
        ])->findOrFail($id);
        
        return response()->json($equipment);
    }

    public function destroy(int $id): JsonResponse
    {
        $equipment = Equipment::findOrFail($id);
        $equipment->delete();
        
        return response()->json(["message" => "ØªØ¬Ù‡ÛŒØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯"]);
    }
}

--------------------------------------------------------------------------------
【فایل 7】: EquipmentController.php
📁 مسیر: app\Http\Controllers\Api\EquipmentController.php
📅 تاریخ آخرین تغییر: 02/13/2026 10:37:22
📏 حجم: 11980 بایت
--------------------------------------------------------------------------------

<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use App\Models\Equipment;
use App\Models\EquipmentLocation;
use App\Models\EquipmentCommunication;
use App\Models\ChecklistItem;
use App\Models\Activity;
use App\Models\Consumable;
use App\Models\CellSpecification;
use App\Models\CellEquipment;
use Illuminate\Http\Request;
use Illuminate\Http\JsonResponse;

class EquipmentController extends Controller
{
    public function store(Request $request): JsonResponse
    {
        $validated = $request->validate([
            "inspection_id" => "required|exists:inspections,id",
            "equipment_index" => "required|integer",
            "equipment_type" => "required|string|max:100",
            "scada_code" => "nullable|string|max:10",
            "installation_type" => "nullable|string|max:50",
            "switch_brand" => "nullable|string|max:100",
            "modem_brand" => "nullable|string|max:100",
            "rtu_brand" => "nullable|string|max:100",
            "other_switch_brand" => "nullable|string|max:100",
            "other_modem_brand" => "nullable|string|max:100",
            "other_rtu_brand" => "nullable|string|max:100",
            "start_time" => "nullable|date_format:H:i",
            "end_time" => "nullable|date_format:H:i",
            "department" => "nullable|string|max:100",
            "city_gis_code" => "nullable|string|max:100",
            
            // Ã™ÂÃ›Å’Ã˜Â¯Ã˜Â±Ã™â€¡Ã˜Â§
            "feeders" => "nullable|array",
            "feeders.*.feeder_number" => "required_with:feeders|integer",
            "feeders.*.post_name" => "required_with:feeders|string",
            "feeders.*.feeder_name" => "required_with:feeders|string",
            
            // Ã™â€¦Ã™Ë†Ã™â€šÃ˜Â¹Ã›Å’Ã˜Âª
            "latitude" => "nullable|string|max:50",
            "longitude" => "nullable|string|max:50",
            "installation_address" => "nullable|string",
            "cabinet_initial_height" => "nullable|numeric",
            "cabinet_final_height" => "nullable|numeric",
            
            // Ã˜Â§Ã˜Â±Ã˜ÂªÃ˜Â¨Ã˜Â§Ã˜Â·Ã˜Â§Ã˜Âª
            "simcard_type" => "nullable|string|max:50",
            "simcard_number" => "nullable|string|max:20",
            "simcard_ip" => "nullable|string|max:20",
            "antenna_status" => "nullable|string|max:50",
            "signal_status" => "nullable|string|max:50",
            "modem_power" => "nullable|string|max:50",
            "reset_possible" => "nullable|boolean",
            
            // Ãšâ€ ÃšÂ©Ã¢â‚¬Å’Ã™â€žÃ›Å’Ã˜Â³Ã˜Âª
            "checklist_items" => "nullable|array",
            "checklist_items.*.item_index" => "required_with:checklist_items|integer",
            "checklist_items.*.item_text" => "required_with:checklist_items|string",
            "checklist_items.*.status" => "nullable|in:OK,Not OK,Not Checked",
            "checklist_items.*.description" => "nullable|string",
            
            // Ã™ÂÃ˜Â¹Ã˜Â§Ã™â€žÃ›Å’Ã˜ÂªÃ¢â‚¬Å’Ã™â€¡Ã˜Â§
            "activities" => "nullable|array",
            "activities.*.activity_code" => "required_with:activities|string|max:20",
            "activities.*.activity_title" => "nullable|string",
            "activities.*.unit" => "nullable|string|max:50",
            "activities.*.unit_price" => "nullable|numeric",
            "activities.*.quantity" => "nullable|integer|min:1",
            
            // Ã™â€¦Ã˜ÂµÃ˜Â§Ã˜Â±Ã™Â
            "consumables" => "nullable|array",
            "consumables.*.item_name" => "required_with:consumables|string|max:200",
            "consumables.*.quantity" => "nullable|integer|min:1",
            "consumables.*.unit" => "nullable|string|max:50",
            "consumables.*.description" => "nullable|string",
            "consumables.*.other_name" => "nullable|string|max:200",
            
            // Ã˜Â³Ã™â€žÃ™Ë†Ã™â€žÃ¢â‚¬Å’Ã™â€¡Ã˜Â§
            "cell_specifications" => "nullable|array",
            "cell_specifications.*.cell_type" => "required_with:cell_specifications|in:input,output,measurement",
            "cell_specifications.*.cell_number" => "required_with:cell_specifications|integer",
            "cell_specifications.*.cell_notes" => "nullable|string",
            "cell_specifications.*.cell_equipments" => "nullable|array",
            "cell_specifications.*.cell_equipments.*.equipment_type" => "required_with:cell_specifications.*.cell_equipments|string|max:100",
            "cell_specifications.*.cell_equipments.*.brand" => "nullable|string|max:100",
            "cell_specifications.*.cell_equipments.*.other_brand" => "nullable|string|max:100",
            "cell_specifications.*.cell_equipments.*.manual_name" => "nullable|string|max:200",
        ]);

        // Ã˜Â§Ã›Å’Ã˜Â¬Ã˜Â§Ã˜Â¯ Ã˜ÂªÃ˜Â¬Ã™â€¡Ã›Å’Ã˜Â² Ã˜Â§Ã˜ÂµÃ™â€žÃ›Å’
        $equipment = Equipment::create([
            "inspection_id" => $validated["inspection_id"],
            "equipment_index" => $validated["equipment_index"],
            "equipment_type" => $validated["equipment_type"],
            "scada_code" => $validated["scada_code"] ?? null,
            "installation_type" => $validated["installation_type"] ?? null,
            "switch_brand" => $validated["switch_brand"] ?? null,
            "modem_brand" => $validated["modem_brand"] ?? null,
            "rtu_brand" => $validated["rtu_brand"] ?? null,
            "other_switch_brand" => $validated["other_switch_brand"] ?? null,
            "other_modem_brand" => $validated["other_modem_brand"] ?? null,
            "other_rtu_brand" => $validated["other_rtu_brand"] ?? null,
            "start_time" => $validated["start_time"] ?? null,
            "end_time" => $validated["end_time"] ?? null,
            "department" => $validated["department"] ?? null,
            "city_gis_code" => $validated["city_gis_code"] ?? null,
        ]);

        // Ã˜Â°Ã˜Â®Ã›Å’Ã˜Â±Ã™â€¡ Ã™ÂÃ›Å’Ã˜Â¯Ã˜Â±Ã™â€¡Ã˜Â§
        if ($request->has("feeders")) {
            $feedersData = [];
            foreach ($validated["feeders"] as $index => $feeder) {
                $feedersData[$feeder["feeder_name"]] = [
                    "feeder_number" => $feeder["feeder_number"],
                    "post_name" => $feeder["post_name"],
                    "feeder_name" => $feeder["feeder_name"]
                ];
            }
            $equipment->feeders()->sync($feedersData);
        }

        // Ã˜Â°Ã˜Â®Ã›Å’Ã˜Â±Ã™â€¡ Ã™â€¦Ã™Ë†Ã™â€šÃ˜Â¹Ã›Å’Ã˜Âª
        if ($request->hasAny(["latitude", "longitude", "installation_address", "cabinet_initial_height", "cabinet_final_height"])) {
            EquipmentLocation::create([
                "equipment_id" => $equipment->id,
                "latitude" => $validated["latitude"] ?? null,
                "longitude" => $validated["longitude"] ?? null,
                "installation_address" => $validated["installation_address"] ?? null,
                "cabinet_initial_height" => $validated["cabinet_initial_height"] ?? null,
                "cabinet_final_height" => $validated["cabinet_final_height"] ?? null,
            ]);
        }

        // Ã˜Â°Ã˜Â®Ã›Å’Ã˜Â±Ã™â€¡ Ã˜Â§Ã˜Â±Ã˜ÂªÃ˜Â¨Ã˜Â§Ã˜Â·Ã˜Â§Ã˜Âª
        if ($request->hasAny(["simcard_type", "simcard_number", "simcard_ip", "antenna_status", "signal_status", "modem_power"])) {
            EquipmentCommunication::create([
                "equipment_id" => $equipment->id,
                "simcard_type" => $validated["simcard_type"] ?? null,
                "simcard_number" => $validated["simcard_number"] ?? null,
                "simcard_ip" => $validated["simcard_ip"] ?? null,
                "antenna_status" => $validated["antenna_status"] ?? null,
                "signal_status" => $validated["signal_status"] ?? null,
                "modem_power" => $validated["modem_power"] ?? null,
                "reset_possible" => $validated["reset_possible"] ?? false,
            ]);
        }

        // Ã˜Â°Ã˜Â®Ã›Å’Ã˜Â±Ã™â€¡ Ãšâ€ ÃšÂ©Ã¢â‚¬Å’Ã™â€žÃ›Å’Ã˜Â³Ã˜Âª
        if ($request->has("checklist_items")) {
            foreach ($validated["checklist_items"] as $item) {
                ChecklistItem::create([
                    "equipment_id" => $equipment->id,
                    "item_index" => $item["item_index"],
                    "item_text" => $item["item_text"],
                    "status" => $item["status"] ?? "Not Checked",
                    "description" => $item["description"] ?? null,
                ]);
            }
        }

        // Ã˜Â°Ã˜Â®Ã›Å’Ã˜Â±Ã™â€¡ Ã™ÂÃ˜Â¹Ã˜Â§Ã™â€žÃ›Å’Ã˜ÂªÃ¢â‚¬Å’Ã™â€¡Ã˜Â§
        if ($request->has("activities")) {
            foreach ($validated["activities"] as $activity) {
                $quantity = $activity["quantity"] ?? 1;
                $unitPrice = $activity["unit_price"] ?? 0;
                
                Activity::create([
                    "equipment_id" => $equipment->id,
                    "activity_code" => $activity["activity_code"],
                    "activity_title" => $activity["activity_title"] ?? null,
                    "unit" => $activity["unit"] ?? null,
                    "unit_price" => $unitPrice,
                    "quantity" => $quantity,
                    "total_price" => $quantity * $unitPrice,
                ]);
            }
        }

        // Ã˜Â°Ã˜Â®Ã›Å’Ã˜Â±Ã™â€¡ Ã™â€¦Ã˜ÂµÃ˜Â§Ã˜Â±Ã™Â
        if ($request->has("consumables")) {
            foreach ($validated["consumables"] as $consumable) {
                Consumable::create([
                    "equipment_id" => $equipment->id,
                    "item_name" => $consumable["item_name"],
                    "quantity" => $consumable["quantity"] ?? 1,
                    "unit" => $consumable["unit"] ?? null,
                    "description" => $consumable["description"] ?? null,
                    "other_name" => $consumable["other_name"] ?? null,
                ]);
            }
        }

        // Ã˜Â°Ã˜Â®Ã›Å’Ã˜Â±Ã™â€¡ Ã˜Â³Ã™â€žÃ™Ë†Ã™â€žÃ¢â‚¬Å’Ã™â€¡Ã˜Â§
        if ($request->has("cell_specifications")) {
            foreach ($validated["cell_specifications"] as $spec) {
                $cellSpec = CellSpecification::create([
                    "equipment_id" => $equipment->id,
                    "cell_type" => $spec["cell_type"],
                    "cell_number" => $spec["cell_number"],
                    "cell_notes" => $spec["cell_notes"] ?? null,
                ]);
                
                if (isset($spec["cell_equipments"])) {
                    foreach ($spec["cell_equipments"] as $cellEq) {
                        CellEquipment::create([
                            "cell_id" => $cellSpec->id,
                            "equipment_type" => $cellEq["equipment_type"],
                            "brand" => $cellEq["brand"] ?? null,
                            "other_brand" => $cellEq["other_brand"] ?? null,
                            "manual_name" => $cellEq["manual_name"] ?? null,
                        ]);
                    }
                }
            }
        }

        return response()->json($equipment->load([
            "feeders",
            "location",
            "communication",
            "checklistItems",
            "activities",
            "consumables",
            "cellSpecifications.cellEquipments"
        ]), 201);
    }

    public function show(int $id): JsonResponse
    {
        $equipment = Equipment::with([
            "feeders",
            "location",
            "communication",
            "checklistItems",
            "activities",
            "consumables",
            "cellSpecifications.cellEquipments"
        ])->findOrFail($id);
        
        return response()->json($equipment);
    }

    public function destroy(int $id): JsonResponse
    {
        $equipment = Equipment::findOrFail($id);
        $equipment->delete();
        
        return response()->json(["message" => "Ã˜ÂªÃ˜Â¬Ã™â€¡Ã›Å’Ã˜Â² Ã˜Â¨Ã˜Â§ Ã™â€¦Ã™Ë†Ã™ÂÃ™â€šÃ›Å’Ã˜Âª Ã˜Â­Ã˜Â°Ã™Â Ã˜Â´Ã˜Â¯"]);
    }
}

--------------------------------------------------------------------------------
【فایل 8】: EquipmentController.php (2).backup
📁 مسیر: app\Http\Controllers\EquipmentController.php (2).backup
📅 تاریخ آخرین تغییر: 02/10/2026 13:44:05
📏 حجم: 742 بایت
--------------------------------------------------------------------------------

<?php

namespace App\Http\Controllers;

use App\Models\Equipment;
use Illuminate\Http\Request;

class EquipmentController extends Controller
{
    public function index()
    {
        return Equipment::all();
    }
    public function index() {
        return Equipment::all();
    }

    public function store(Request \) {
        \ = \->validate([]);
        return Equipment::create(\);
    }

    public function show(\) {
        return Equipment::findOrFail(\);
    }

    public function update(Request \, \) {
        \ = Equipment::findOrFail(\);
        \->update(\->validate([]));
        return \;
    }

    public function destroy(\) {
        Equipment::findOrFail(\)->delete();
        return response()->noContent();
    }
}

--------------------------------------------------------------------------------
【فایل 9】: EquipmentController.php (3).backup
📁 مسیر: app\Http\Controllers\EquipmentController.php (3).backup
📅 تاریخ آخرین تغییر: 02/10/2026 13:44:05
📏 حجم: 742 بایت
--------------------------------------------------------------------------------

<?php

namespace App\Http\Controllers;

use App\Models\Equipment;
use Illuminate\Http\Request;

class EquipmentController extends Controller
{
    public function index()
    {
        return Equipment::all();
    }
    public function index() {
        return Equipment::all();
    }

    public function store(Request \) {
        \ = \->validate([]);
        return Equipment::create(\);
    }

    public function show(\) {
        return Equipment::findOrFail(\);
    }

    public function update(Request \, \) {
        \ = Equipment::findOrFail(\);
        \->update(\->validate([]));
        return \;
    }

    public function destroy(\) {
        Equipment::findOrFail(\)->delete();
        return response()->noContent();
    }
}

--------------------------------------------------------------------------------
【فایل 10】: EquipmentController.php.backup
📁 مسیر: app\Http\Controllers\EquipmentController.php.backup
📅 تاریخ آخرین تغییر: 02/10/2026 13:44:05
📏 حجم: 742 بایت
--------------------------------------------------------------------------------

<?php

namespace App\Http\Controllers;

use App\Models\Equipment;
use Illuminate\Http\Request;

class EquipmentController extends Controller
{
    public function index()
    {
        return Equipment::all();
    }
    public function index() {
        return Equipment::all();
    }

    public function store(Request \) {
        \ = \->validate([]);
        return Equipment::create(\);
    }

    public function show(\) {
        return Equipment::findOrFail(\);
    }

    public function update(Request \, \) {
        \ = Equipment::findOrFail(\);
        \->update(\->validate([]));
        return \;
    }

    public function destroy(\) {
        Equipment::findOrFail(\)->delete();
        return response()->noContent();
    }
}

================================================================================
                        پایان فایل EquipmentController.php
================================================================================
